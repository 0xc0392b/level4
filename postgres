
level4 λ docker ps -a
CONTAINER ID   IMAGE          COMMAND                  CREATED        STATUS                    PORTS     NAMES
e7abbb93c171   mongo:latest   "docker-entrypoint.s…"   4 months ago   Exited (0) 4 months ago             mongodb
level4 λ docker rm mongodb
mongodb
level4 λ docker run -d --name timescaledb -p 5432:5432 -e POSTGRES_PASSWORD=level4 timescale/timescaledb:latest-pg12
Unable to find image 'timescale/timescaledb:latest-pg12' locally
latest-pg12: Pulling from timescale/timescaledb













Digest: sha256:187dcef7384f1f100530b0dc1295acb6afb00a52ea6d720a0a0618d7ad81c241
Status: Downloaded newer image for timescale/timescaledb:latest-pg12
dc9606bb3a3f85f374be2bf5e1e9671aaea8101da051791fb88d56f28365f46b
level4 λ docker rm timescaledb
timescaledb
level4 λ docker rm timescaledb
timescaledb
level4 λ docker run -d --name level4_timescaledb -p 127.0.0.1:5432:5432 -e POSTGRES_USER=level4  -e POSTGRES_PASSWORD=level4 timescale/timescaledb:latest-pg12
5839259117adf988e8ecd0f246a0cbd8d7be0677ad2d7f0a36a2fd906d5dcdd3
level4 λ docker exec -ti level4_timescaledb psql -U level4
psql (12.9)
Type "help" for help.

level4=# 

level4=# exit
exit
level4 λ ls
_build  config  deps  lib  mix.exs  mix.lock  README.md  test
level4 λ mix ecto.create
Compiling 30 files (.ex)
warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitmex.ex:14: Exchanges.Bitmex.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bittrex.ex:14: Exchanges.BitTrex.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/ftx.ex:14: Exchanges.FTX.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/binance.ex:14: Exchanges.Binance.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/hitbtc.ex:14: Exchanges.HitBTC.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/cexio.ex:14: Exchanges.CexIO.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/gemini.ex:14: Exchanges.Gemini.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitstamp.ex:14: Exchanges.Bitstamp.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitfinex.ex:14: Exchanges.Bitfinex.make_subscribe_message/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bybit.ex:14: Exchanges.Bybit.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitmex.ex:14: Exchanges.Bitmex.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bittrex.ex:14: Exchanges.BitTrex.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/ftx.ex:14: Exchanges.FTX.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/binance.ex:14: Exchanges.Binance.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/cexio.ex:14: Exchanges.CexIO.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/hitbtc.ex:14: Exchanges.HitBTC.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/gemini.ex:14: Exchanges.Gemini.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bybit.ex:14: Exchanges.Bybit.make_subscribe_message/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/ftx.ex:19: Exchanges.FTX.translate/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitstamp.ex:14: Exchanges.Bitstamp.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitfinex.ex:14: Exchanges.Bitfinex.make_subscribe_message/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bittrex.ex:19: Exchanges.BitTrex.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/binance.ex:19: Exchanges.Binance.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitmex.ex:19: Exchanges.Bitmex.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/cexio.ex:19: Exchanges.CexIO.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/hitbtc.ex:19: Exchanges.HitBTC.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bybit.ex:19: Exchanges.Bybit.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bittrex.ex:19: Exchanges.BitTrex.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/gemini.ex:19: Exchanges.Gemini.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitstamp.ex:19: Exchanges.Bitstamp.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/binance.ex:19: Exchanges.Binance.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/ftx.ex:19: Exchanges.FTX.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitmex.ex:19: Exchanges.Bitmex.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/cexio.ex:19: Exchanges.CexIO.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/hitbtc.ex:19: Exchanges.HitBTC.translate/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitfinex.ex:19: Exchanges.Bitfinex.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitstamp.ex:19: Exchanges.Bitstamp.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bybit.ex:19: Exchanges.Bybit.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/gemini.ex:19: Exchanges.Gemini.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/bitfinex.ex:19: Exchanges.Bitfinex.translate/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/huobi.ex:14: Exchanges.Huobi.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/huobi.ex:14: Exchanges.Huobi.make_subscribe_message/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/huobi.ex:19: Exchanges.Huobi.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/huobi.ex:19: Exchanges.Huobi.translate/2

warning: variable "major_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/kraken.ex:14: Exchanges.Kraken.make_subscribe_message/2

warning: variable "quote_symbol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/kraken.ex:14: Exchanges.Kraken.make_subscribe_message/2

warning: variable "json" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/kraken.ex:19: Exchanges.Kraken.translate/2

warning: variable "sync_state" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/kraken.ex:19: Exchanges.Kraken.translate/2

warning: variable "epoch_ms" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:37: Exchanges.Poloniex.translate/2

warning: variable "epoch_ms" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:56: Exchanges.Poloniex.translate/2

warning: variable "epoch_ms" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:61: Exchanges.Poloniex.translate/2

warning: variable "epoch_ms" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:66: Exchanges.Poloniex.translate/2

warning: variable "price_Str" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:66: Exchanges.Poloniex.translate/2

warning: variable "size_str" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:66: Exchanges.Poloniex.translate/2

warning: variable "timestamp" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:66: Exchanges.Poloniex.translate/2

warning: variable "trade_id" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:66: Exchanges.Poloniex.translate/2

warning: variable "epoch_ms" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:69: Exchanges.Poloniex.translate/2

warning: variable "price_str" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:69: Exchanges.Poloniex.translate/2

warning: variable "size_str" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:69: Exchanges.Poloniex.translate/2

warning: variable "timestamp" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:69: Exchanges.Poloniex.translate/2

warning: variable "trade_id" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:69: Exchanges.Poloniex.translate/2

warning: variable "channel_id" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:34: Exchanges.Poloniex.translate/2

warning: variable "sequence_num" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/exchanges/poloniex.ex:34: Exchanges.Poloniex.translate/2

warning: variable "a" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/supervisor.ex:19: Market.Supervisor.start_link/2

warning: variable "protocol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:90: Market.Level2.WebSocket.handle_info/2

warning: variable "market" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:55: Market.Exchange.terminate/2

warning: variable "reason" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:55: Market.Exchange.terminate/2

warning: variable "headers" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:100: Market.Level2.WebSocket.handle_info/2

warning: variable "new_price" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:66: Market.Exchange.handle_cast/2

warning: variable "protocols" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:100: Market.Level2.WebSocket.handle_info/2

warning: variable "new_size" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:66: Market.Exchange.handle_cast/2

warning: variable "timestamp" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:66: Market.Exchange.handle_cast/2

warning: variable "data" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:123: Market.Level2.WebSocket.handle_info/2

warning: variable "new_price" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:81: Market.Exchange.handle_cast/2

warning: variable "is_fin" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:123: Market.Level2.WebSocket.handle_info/2

warning: variable "new_size" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:81: Market.Exchange.handle_cast/2

warning: variable "stream_ref" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:123: Market.Level2.WebSocket.handle_info/2

warning: variable "timestamp" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/exchange.ex:81: Market.Exchange.handle_cast/2

warning: variable "stream_ref" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:132: Market.Level2.WebSocket.handle_info/2

warning: variable "stream_ref" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:223: Market.Level2.WebSocket.handle_info/2

warning: variable "killed_streams" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:241: Market.Level2.WebSocket.handle_info/2

warning: variable "protocol" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:241: Market.Level2.WebSocket.handle_info/2

warning: variable "headers" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:260: Market.Level2.WebSocket.handle_info/2

warning: variable "is_fin" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:260: Market.Level2.WebSocket.handle_info/2

warning: variable "stream_ref" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:260: Market.Level2.WebSocket.handle_info/2

warning: variable "stream_ref" is unused (if the variable is not meant to be used, prefix it with an underscore)
  lib/market/level2/websocket.ex:279: Market.Level2.WebSocket.handle_info/2

warning: module attribute @protocoldoc was set but never used
  lib/translation.ex:2

warning: invalid association `markets` in schema Storage.Model.Symbol: associated schema Storage.Model.Market does not have field `symbol_id`
  lib/storage/models/symbol.ex:1: Storage.Model.Symbol (module)

Generated level4 app
The database for Storage.Repo has already been created
level4 λ docker exec -ti level4_timescaledb psql -U level4
psql (12.9)
Type "help" for help.

level4=# show databases;
show databases;
ERROR:  unrecognized configuration parameter "databases"
level4=# \l
\l
                              List of databases
   Name    | Owner  | Encoding |  Collate   |   Ctype    | Access privileges 
-----------+--------+----------+------------+------------+-------------------
 level4    | level4 | UTF8     | en_US.utf8 | en_US.utf8 | 
 postgres  | level4 | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +
           |        |          |            |            | level4=CTc/level4
 template1 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +
           |        |          |            |            | level4=CTc/level4
(4 rows)

level4=# \c level4
\c level4
You are now connected to database "level4" as user "level4".
level4=# 

level4=# \dt
\dt
Did not find any relations.
level4=# mix ecto.create
mix ecto.create
level4-# 

level4-# ;
;
ERROR:  syntax error at or near "mix"
LINE 1: mix ecto.create
        ^
level4=# exit
exit
level4 λ mix ecto.create
Compiling 1 file (.ex)
The database for Storage.Repo has already been created
level4 λ mix ecto.gen.migration create_exchanges
* creating priv/repo/migrations
* creating priv/repo/migrations/20211204034841_create_exchanges.exs
level4 λ mix ecto.gen.migration create_markets
* creating priv/repo/migrations/20211204034850_create_markets.exs
level4 λ mix ecto.gen.migration create_spread_changes
* creating priv/repo/migrations/20211204034906_create_spread_changes.exs
level4 λ mix ecto.gen.migration create_symbols
* creating priv/repo/migrations/20211204034912_create_symbols.exs
level4 λ docker exec -ti level4_timescaledb psql -U level4
psql (12.9)
Type "help" for help.

level4=# \l
\l
                              List of databases
   Name    | Owner  | Encoding |  Collate   |   Ctype    | Access privileges 
-----------+--------+----------+------------+------------+-------------------
 level4    | level4 | UTF8     | en_US.utf8 | en_US.utf8 | 
 postgres  | level4 | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +
           |        |          |            |            | level4=CTc/level4
 template1 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +
           |        |          |            |            | level4=CTc/level4
(4 rows)

level4=# \c level4
\c level4
You are now connected to database "level4" as user "level4".
level4=# \dt
\dt
Did not find any relations.
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
 public | symbols           | table | level4
(2 rows)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
(0 rows)

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
(1 row)

level4=# drop table schema_migrations;
drop table schema_migrations;
DROP TABLE
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | schema_migrations | table | level4
(2 rows)

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
(1 row)

level4=# drop table schema_migrations;
drop table schema_migrations;
DROP TABLE
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# select * from exchanges;
select * from exchanges;
 id | name 
----+------
(0 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
(0 rows)

level4=# insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 1, 1, "SPOT");
insert into markets values (1, 1, 1, "SPOT");
ERROR:  column "SPOT" does not exist
LINE 1: insert into markets values (1, 1, 1, "SPOT");
                                             ^
level4=# insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 1, 1, "SPOT");
insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 1, 1, "SPOT");
ERROR:  column "SPOT" does not exist
LINE 1: ...mbol_id, exchange_id, market_type) values (1, 1, 1, "SPOT");
                                                               ^
level4=# 

level4=# 

level4=# insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 1, 1, 'SPOT');
insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 1, 1, 'SPOT');
ERROR:  insert or update on table "markets" violates foreign key constraint "markets_major_symbol_id_fkey"
DETAIL:  Key (major_symbol_id)=(1) is not present in table "symbols".
level4=# drop table schema_migrations;
drop table schema_migrations;
DROP TABLE
level4=# \dt
\dt
Did not find any relations.
level4=# 

level4=# 

level4=# insert into exchanges (name) values ('Poloniex');
insert into exchanges values ('Coinbase');
ERROR:  invalid input syntax for type bigint: "Coinbase"
LINE 1: insert into exchanges values ('Coinbase');
                                      ^
level4=# insert into exchanges (name) values ('Coinbase');
insert into exchanges (name) values ('Coinbase');
INSERT 0 1
level4=# select * from exchanges ;
select * from exchanges ;
 id |   name   
----+----------
  1 | Coinbase
(1 row)

level4=# insert into exchanges (name) values ('FTX');
insert into exchanges (name) values ('Poloniex');
INSERT 0 1
level4=# insert into exchanges (name) values ('BYBIT);
insert into exchanges (name) values ('FTX');
INSERT 0 1
level4=# insert into exchanges (name) values ('BYBIT);
insert into exchanges (name) values ('BYBIT);
level4'# select * from exchanges ;
select * from exchanges ;
level4'# 

level4'# select * from exchanges ;
select * from exchanges ;
level4'# 

level4'# ;
;
level4'# ;
;
level4'# a
a
level4'# \dt
\dt
level4'#   C-c C-c
level4=# 

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# select * from exchanges ;
select * from exchanges ;
 id |   name   
----+----------
  1 | Coinbase
  2 | Poloniex
  3 | FTX
(3 rows)

level4=# 

level4=# 

level4=# select * from symbols ;
select * from symbols ;
 id | symbol 
----+--------
(0 rows)

level4=# insert into symbols (symbol) values ('ETH');
insert into symbols (symbol) values ('BTC');
INSERT 0 1
level4=# insert into symbols (symbol) values ('LTC');
insert into symbols (symbol) values ('ETH');
INSERT 0 1
level4=# insert into symbols (symbol) values ('GBP');
insert into symbols (symbol) values ('LTC');
INSERT 0 1
level4=# insert into symbols (symbol) values ('USD');
insert into symbols (symbol) values ('GBP');
INSERT 0 1
level4=# insert into symbols (symbol) values ('USD');
insert into symbols (symbol) values ('USD');
INSERT 0 1
level4=# select * from symbols ;
select * from symbols ;
 id | symbol 
----+--------
  1 | BTC
  2 | ETH
  3 | LTC
  4 | GBP
  5 | USD
(5 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
(0 rows)

level4=# insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 4, 1, 'SPOT') ;
insert into markets (major_symbol_id, quote_symbol_id, exchange_id, market_type) values (1, 4, 1, 'SPOT') ;
INSERT 0 1
level4=# 

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
(1 row)

level4=# select * from spread_changes ;
select * from spread_changes ;
 id | market_id | best_bid_price | best_ask_price | timestamp 
----+-----------+----------------+----------------+-----------
(0 rows)

level4=# insert into spread_changes (market_id, best_bid_price, best_ask_price, timestamp) values (1, 100, 101, now()) ;
insert into spread_changes (market_id, best_bid_price, best_ask_price, timestamp) values (1, 100, 101, now()) ;
INSERT 0 1
level4=# select * from spread_changes ;
select * from spread_changes ;
 id | market_id | best_bid_price | best_ask_price |         timestamp          
----+-----------+----------------+----------------+----------------------------
  1 |         1 |            100 |            101 | 2021-12-04 04:31:14.713369
(1 row)

level4=# drop database level4;
drop database level4
level4-# drop database level4;
drop database level4;
ERROR:  syntax error at or near "drop"
LINE 2: drop database level4;
        ^
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# drop table exchanges cascade;
drop table exchanges;
ERROR:  cannot drop table exchanges because other objects depend on it
DETAIL:  constraint markets_exchange_id_fkey on table markets depends on table exchanges
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
level4=# drop table markets cascade;
drop table exchanges cascade;
NOTICE:  drop cascades to constraint markets_exchange_id_fkey on table markets
DROP TABLE
level4=# drop table spread_changes cascade;
drop table markets cascade;
NOTICE:  drop cascades to constraint spread_changes_market_id_fkey on table spread_changes
DROP TABLE
level4=# drop table symbols cascade;
drop table spread_changes cascade;
DROP TABLE
level4=# drop table schema_migrations cascade;
drop table symbols cascade;
DROP TABLE
level4=# drop table schema_migrations cascade;
drop table schema_migrations cascade;
DROP TABLE
level4=# 

level4=# 

level4=# \dt
\dt
Did not find any relations.
level4=# 

level4=# 

level4=# 

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
(1 row)

level4=# drop table schema_migrations cascade;
drop table schema_migrations cascade;
DROP TABLE
level4=# 

level4=# 

level4=# 

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
(1 row)

level4=# drop table schema_migrations cascade;
drop table schema_migrations cascade;
DROP TABLE
level4=# 

level4=# 

level4=# 

level4=# 

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
(0 rows)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | BTC
(1 row)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | BTC
  2 | LTC
  3 | ETH
(3 rows)

level4=# select * from exchanges;
select * from exchanges;
 id |   name   
----+----------
  1 | Coinbase
  2 | Poloniex
(2 rows)

level4=# \dtr
\dtr
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
(0 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
(0 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
(1 row)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
  2 |               2 |               4 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
(3 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
  2 |               2 |               4 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
(3 rows)

level4=# select * from exchanges;
select * from exchanges;
 id |   name   
----+----------
  1 | Coinbase
  2 | Poloniex
(2 rows)

level4=# select * from exchanges;
select * from exchanges;
 id |     name     
----+--------------
  1 | Coinbase
  2 | Poloniex
  3 | COINBASE-PRO
(3 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
  2 |               2 |               4 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               2 |               4 |           3 | SPOT
(4 rows)

level4=# select * from exchanges;
select * from exchanges;
 id |     name     
----+--------------
  1 | Coinbase
  2 | Poloniex
  3 | COINBASE-PRO
(3 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               4 |           1 | SPOT
  2 |               2 |               4 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               2 |               4 |           3 | SPOT
(4 rows)

level4=# select * from spread_changes;
select * from spread_changes;
 id | market_id | best_bid_price | best_ask_price | timestamp 
----+-----------+----------------+----------------+-----------
(0 rows)

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | spread_changes    | table | level4
 public | symbols           | table | level4
(5 rows)

level4=# drop table markets cascade ;
drop table exchanges cascade ;
NOTICE:  drop cascades to constraint markets_exchange_id_fkey on table markets
DROP TABLE
level4=# drop table spread_changes cascade ;
drop table markets cascade ;
NOTICE:  drop cascades to constraint spread_changes_market_id_fkey on table spread_changes
DROP TABLE
level4=# drop table symbols cascade ;
drop table spread_changes cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table symbols cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table schema_migrations cascade ;
DROP TABLE
level4=# 

level4=# 

level4=# \dt
\dt
Did not find any relations.
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | best_ask_prices   | table | level4
 public | best_bid_prices   | table | level4
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | symbols           | table | level4
(6 rows)

level4=# select * from best_bid_prices;
select * from best_bid_prices;
 id | market_id | price | size | timestamp 
----+-----------+-------+------+-----------
(0 rows)

level4=# select * from exchanges;
select * from exchanges;
 id |     name     
----+--------------
  1 | COINBASE-PRO
(1 row)

level4=# select * from markets;
select * from markets;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
(1 row)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
(2 rows)

level4=# select * from best_bid_prices;
select * from best_ask_prices;
 id | market_id | price  |    size     |         timestamp          
----+-----------+--------+-------------+----------------------------
  1 |         1 | 119.86 |  5.86548162 | 2021-12-07 06:01:26.19552
  2 |         1 |  119.9 |  1.58543167 | 2021-12-07 06:01:49.792565
  3 |         1 | 119.92 | 21.28442558 | 2021-12-07 06:01:49.80813
  4 |         1 | 119.91 |         3.5 | 2021-12-07 06:01:51.079424
(4 rows)

level4=# select * from best_bid_prices;
select * from best_bid_prices;
 id | market_id | price  |    size     |         timestamp          
----+-----------+--------+-------------+----------------------------
  1 |         1 | 119.74 |         3.5 | 2021-12-07 06:01:26.632475
  2 |         1 | 119.75 |      0.9955 | 2021-12-07 06:01:49.607407
  3 |         1 | 119.76 |         3.5 | 2021-12-07 06:01:49.622881
  4 |         1 | 119.77 |      0.9955 | 2021-12-07 06:01:49.76974
  5 |         1 | 119.78 |         3.5 | 2021-12-07 06:01:49.814421
  6 |         1 | 119.79 |  9.42215258 | 2021-12-07 06:01:49.827187
  7 |         1 |  119.8 |         3.5 | 2021-12-07 06:01:49.875936
  8 |         1 | 119.81 |      0.9955 | 2021-12-07 06:02:06.502465
  9 |         1 | 119.82 |         3.5 | 2021-12-07 06:02:06.530334
 10 |         1 | 119.84 |  9.41743017 | 2021-12-07 06:02:06.688469
 11 |         1 | 119.85 |         3.5 | 2021-12-07 06:02:06.712586
 12 |         1 | 119.88 |  2.64241765 | 2021-12-07 06:02:08.245899
 13 |         1 | 119.89 |         3.5 | 2021-12-07 06:02:08.266164
 14 |         1 | 119.88 | 12.05674423 | 2021-12-07 06:02:09.412629
 15 |         1 | 119.89 |         3.5 | 2021-12-07 06:02:09.772935
 16 |         1 | 119.85 |  5.80819757 | 2021-12-07 06:02:10.122872
 17 |         1 | 119.86 |  9.41578094 | 2021-12-07 06:02:10.749535
 18 |         1 | 119.87 |         3.5 | 2021-12-07 06:02:10.769254
(18 rows)

level4=# select * from best_bid_prices;
select * from best_bid_prices;
 id  | market_id |  price   |    size     |         timestamp          
-----+-----------+----------+-------------+----------------------------
   1 |         1 |   119.74 |         3.5 | 2021-12-07 06:01:26.632475
   2 |         1 |   119.75 |      0.9955 | 2021-12-07 06:01:49.607407
   3 |         1 |   119.76 |         3.5 | 2021-12-07 06:01:49.622881
   4 |         1 |   119.77 |      0.9955 | 2021-12-07 06:01:49.76974
   5 |         1 |   119.78 |         3.5 | 2021-12-07 06:01:49.814421
   6 |         1 |   119.79 |  9.42215258 | 2021-12-07 06:01:49.827187
   7 |         1 |    119.8 |         3.5 | 2021-12-07 06:01:49.875936
   8 |         1 |   119.81 |      0.9955 | 2021-12-07 06:02:06.502465
   9 |         1 |   119.82 |         3.5 | 2021-12-07 06:02:06.530334
  10 |         1 |   119.84 |  9.41743017 | 2021-12-07 06:02:06.688469
  11 |         1 |   119.85 |         3.5 | 2021-12-07 06:02:06.712586
  12 |         1 |   119.88 |  2.64241765 | 2021-12-07 06:02:08.245899
  13 |         1 |   119.89 |         3.5 | 2021-12-07 06:02:08.266164
  14 |         1 |   119.88 | 12.05674423 | 2021-12-07 06:02:09.412629
  15 |         1 |   119.89 |         3.5 | 2021-12-07 06:02:09.772935
  16 |         1 |   119.85 |  5.80819757 | 2021-12-07 06:02:10.122872
  17 |         1 |   119.86 |  9.41578094 | 2021-12-07 06:02:10.749535
  18 |         1 |   119.87 |         3.5 | 2021-12-07 06:02:10.769254
  19 |         1 |   119.86 |  9.41578094 | 2021-12-07 06:02:15.827548
  20 |         1 |   119.85 |  2.30819757 | 2021-12-07 06:02:15.932958
  21 |         1 |   119.83 | 18.83084855 | 2021-12-07 06:02:15.967831
  22 |         1 |   119.85 |  9.41677826 | 2021-12-07 06:02:15.97331
  23 |         1 |   119.82 |  2.24261763 | 2021-12-07 06:02:15.986711
  24 |         1 |   119.83 |         3.5 | 2021-12-07 06:02:16.182727
  25 |         2 | 38376.92 |   0.0116816 | 2021-12-07 06:02:27.004807
  26 |         2 | 38377.54 |  0.01961216 | 2021-12-07 06:02:27.778704
  27 |         2 | 38378.29 |   0.0165843 | 2021-12-07 06:02:27.795494
  28 |         2 | 38377.54 |  0.01961216 | 2021-12-07 06:02:28.132315
  29 |         2 | 38378.33 |  0.01289939 | 2021-12-07 06:02:28.153307
  30 |         2 | 38376.92 |   0.0116816 | 2021-12-07 06:02:28.504366
  31 |         2 |  38376.9 |     1.5e-05 | 2021-12-07 06:02:31.49222
--More-- 
  32 |         2 | 38375.39 |  0.01961346 | 2021-12-07 06:02:35.384511
--More-- 
  33 |         2 | 38376.48 |  0.02582007 | 2021-12-07 06:02:35.395043
--More-- q
level4=# 

level4=# select count(*) from symbols;
sellect count(*) from exchanges;
ERROR:  syntax error at or near "sellect"
LINE 1: sellect count(*) from exchanges;
        ^
level4=# select count(*) from exchanges;
select count(*) from exchanges;
 count 
-------
     1
(1 row)

level4=# select count(*) from symbols;
select count(*) from symbols;
 count 
-------
     5
(1 row)

level4=# select count(*) from best_bid_prices;
select count(*) from best_ask_prices;
 count 
-------
  1041
(1 row)

level4=# select count(*) from best_bid_prices;
select count(*) from best_bid_prices;
 count 
-------
  1593
(1 row)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
(6 rows)

level4=# select * from markets;
select * from markets;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               5 |               2 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               6 |               2 |           1 | SPOT
  7 |               6 |               4 |           1 | SPOT
(7 rows)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
  7 | ADA
(7 rows)

level4=# select * from markets;
select * from markets;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               5 |               2 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               6 |               2 |           1 | SPOT
  7 |               6 |               4 |           1 | SPOT
  8 |               7 |               4 |           1 | SPOT
  9 |               7 |               2 |           1 | SPOT
(9 rows)

level4=# select * from markets;
select * from markets;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               5 |               2 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               6 |               2 |           1 | SPOT
  7 |               6 |               4 |           1 | SPOT
  8 |               7 |               4 |           1 | SPOT
  9 |               7 |               2 |           1 | SPOT
 10 |               8 |               2 |           1 | SPOT
 11 |               8 |               4 |           1 | SPOT
(11 rows)

level4=# select * from markets;
select * from markets;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               5 |               2 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               6 |               2 |           1 | SPOT
  7 |               6 |               4 |           1 | SPOT
  8 |               7 |               4 |           1 | SPOT
  9 |               7 |               2 |           1 | SPOT
 10 |               8 |               2 |           1 | SPOT
 11 |               8 |               4 |           1 | SPOT
 12 |               9 |               2 |           1 | SPOT
 13 |               9 |               4 |           1 | SPOT
 14 |              10 |               2 |           1 | SPOT
 15 |              10 |               4 |           1 | SPOT
(15 rows)

level4=# select count(*) from best_bid_prices;
select count(*) best_bid_prices;
 best_bid_prices 
-----------------
               1
(1 row)

level4=# select count(*) from best_bid_prices;
select count(*) from best_bid_prices;
 count 
-------
  9312
(1 row)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
  7 | ADA
  8 | CHZ
  9 | OMG
 10 | DOGE
(10 rows)

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
  7 | ADA
  8 | CHZ
  9 | OMG
 10 | DOGE
 11 | SHIB
 12 | SOL
(12 rows)

level4=# SELECT create_hypertable('best_bid_prices', 'timestamp', migrate_data => true);
SELECT create_hypertable('best_bid_prices', 'timestamp');
ERROR:  table "best_bid_prices" is not empty
HINT:  You can migrate data by specifying 'migrate_data => true' when calling this function.
level4=# SELECT create_hypertable('best_bid_prices', 'timestamp', migrate_data => true);
SELECT create_hypertable('best_bid_prices', 'timestamp', migrate_data => true);
NOTICE:  adding not-null constraint to column "timestamp"
DETAIL:  Time dimensions cannot have NULL values.
ERROR:  cannot create a unique index without the column "timestamp" (used in partitioning)
level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
  7 | ADA
  8 | CHZ
  9 | OMG
 10 | DOGE
 11 | SHIB
 12 | SOL
(12 rows)

level4=# MarketSupervisor.start_market(%Market{exchange_name: "POLONIEX", major_symbol: "ETH", quote_symbol: "USDT", market_type: "SPOT", ws_url: "api2.poloniex.com", ws_port: 443, translation_scheme: Exchanges.Poloniex})
MarketSupervisor.start_market(%Market{exchange_name: "POLONIEX", major_symbol: "ETH", quote_symbol: "USDT", market_type: "SPOT", ws_url: "api2.poloniex.com", ws_port: 443, translation_scheme: Exchanges.Poloniex})
level4-# ;
;
ERROR:  syntax error at or near "MarketSupervisor"
LINE 1: MarketSupervisor.start_market(%Market{exchange_name: "POLONI...
        ^
level4=# 

level4=# 

level4=# select * from symbols;
select * from symbols;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | MATIC
  7 | ADA
  8 | CHZ
  9 | OMG
 10 | DOGE
 11 | SHIB
 12 | SOL
 13 | USDT
(13 rows)

level4=# select count(*) from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               5 |               2 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               6 |               2 |           1 | SPOT
  7 |               6 |               4 |           1 | SPOT
  8 |               7 |               4 |           1 | SPOT
  9 |               7 |               2 |           1 | SPOT
 10 |               8 |               2 |           1 | SPOT
 11 |               8 |               4 |           1 | SPOT
 12 |               9 |               2 |           1 | SPOT
 13 |               9 |               4 |           1 | SPOT
 14 |              10 |               2 |           1 | SPOT
 15 |              10 |               4 |           1 | SPOT
 16 |              11 |               2 |           1 | SPOT
 17 |              11 |               4 |           1 | SPOT
 18 |              12 |               2 |           1 | SPOT
 19 |              12 |               4 |           1 | SPOT
 20 |               5 |              13 |           2 | SPOT
 21 |               3 |              13 |           2 | SPOT
 22 |               1 |              13 |           2 | SPOT
(22 rows)

level4=# select * from exchanges ;
select * from exchanges ;
 id |     name     
----+--------------
  1 | COINBASE-PRO
  2 | POLONIEX
(2 rows)

level4=# select count(*) from best_ask_prices;
select count(*) from best_bid_prices;
 count 
-------
 50747
(1 row)

level4=# select count(*) from best_ask_prices;
select count(*) from best_ask_prices;
 count 
-------
 45894
(1 row)

level4=# select count(*) from markets ;
select count(*) from markets ;
 count 
-------
    25
(1 row)

level4=# select count(*) from markets ;
select count(*) from markets ;
 count 
-------
    31
(1 row)

level4=# select count(*) from best_ask_prices;
select count(*) from best_ask_prices;
 count 
-------
 61437
(1 row)

level4=# select count(*) from best_ask_prices;
select count(*) from best_ask_prices;
 count 
-------
 61584
(1 row)

level4=# select count(*) from best_ask_prices;
select count(*) from best_ask_prices;
 count 
-------
 68141
(1 row)

level4=# 

level4=# 

level4=# 

level4=# select count(*) from markets ;
select count(*) from symbols ;
 count 
-------
    18
(1 row)

level4=# select count(*) from exchanges ;
select count(*) from markets ;
 count 
-------
    33
(1 row)

level4=# select count(*) from exchanges ;
select count(*) from exchanges ;
 count 
-------
     2
(1 row)

level4=# select count(*) from best_bid_prices;
select count(*) from best_ask_prices;
 count 
-------
 71155
(1 row)

level4=# select count(*) from best_bid_prices;
select count(*) from best_bid_prices;
 count 
-------
 83280
(1 row)

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# select count(*) from symbols ;
select count(*) from symbols ;
 count 
-------
    18
(1 row)

level4=# select count(*) from markets ;
select count(*) from markets ;
 count 
-------
    33
(1 row)

level4=# select count(*) from exchanges ;
select count(*) from exchanges ;
 count 
-------
     2
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
 count  
--------
 100831
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count 
-------
 90315
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
 count  
--------
 172701
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count  
--------
 154835
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count  
--------
 236899
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
  count  
---------
 2999537
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
  count  
---------
 2979844
(1 row)

level4=# 

level4=# 

level4=# \l+
\l+
                                                                List of databases
   Name    | Owner  | Encoding |  Collate   |   Ctype    | Access privileges |  Size   | Tablespace |                Description                 
-----------+--------+----------+------------+------------+-------------------+---------+------------+--------------------------------------------
 level4    | level4 | UTF8     | en_US.utf8 | en_US.utf8 |                   | 534 MB  | pg_default | 
 postgres  | level4 | UTF8     | en_US.utf8 | en_US.utf8 |                   | 9233 kB | pg_default | default administrative connection database
 template0 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +| 7825 kB | pg_default | unmodifiable empty database
           |        |          |            |            | level4=CTc/level4 |         |            | 
 template1 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +| 9241 kB | pg_default | default template for new databases
           |        |          |            |            | level4=CTc/level4 |         |            | 
(4 rows)

level4=# 

level4=# 

level4=# drop table best_ask_prices ;
drop table best_bid_prices ;
DROP TABLE
level4=# drop table best_ask_prices ;
drop table best_ask_prices ;
DROP TABLE
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | symbols           | table | level4
(4 rows)

level4=# drop table exchanges casecade ;
drop table exchanges casecade ;
ERROR:  syntax error at or near "cascade"
LINE 1: drop table exchanges casecade ;
                             ^
level4=# ERROR:  syntax error at or near "cascade"
ERROR:  syntax error at or near "cascade"
level4-# drop table exchanges;
drop table exchanges;
ERROR:  syntax error at or near "ERROR"
LINE 1: ERROR:  syntax error at or near "cascade"
        ^
level4=# 

level4=# drop table exchanges ;
drop table exchanges cascade ;
ERROR:  cannot drop table exchanges because other objects depend on it
DETAIL:  constraint markets_exchange_id_fkey on table markets depends on table exchanges
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
level4=# drop table markets cascade ;
drop table exchanges cascade ;
NOTICE:  drop cascades to constraint markets_exchange_id_fkey on table markets
DROP TABLE
level4=# 

level4=# drop table symbols cascade ;
drop table markets cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table symbols cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table schema_migrations cascade ;
DROP TABLE
level4=# \dt
\dt
Did not find any relations.
level4=# 

level4=# 

level4=# SELECT create_hypertable('best_bid_prices', 'timestamp');
SELECT create_hypertable('best_bid_prices', 'timestamp');
NOTICE:  adding not-null constraint to column "timestamp"
DETAIL:  Time dimensions cannot have NULL values.
ERROR:  cannot create a unique index without the column "timestamp" (used in partitioning)
level4=# 

level4=# 

level4=# select * from best_bid_prices ;
select * from best_bid_prices ;
 id | market_id | price | size | timestamp 
----+-----------+-------+------+-----------
(0 rows)

level4=# \dtr
\dtr
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | best_ask_prices   | table | level4
 public | best_bid_prices   | table | level4
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | symbols           | table | level4
(6 rows)

level4=# drop table best_bid_prices cascade ;
drop table best_ask_prices cascade ;
DROP TABLE
level4=# drop table best_bid_prices cascade ;
drop table best_bid_prices cascade ;
DROP TABLE
level4=# drop table exchanges cascade ;
drop table exchanges cascade ;
NOTICE:  drop cascades to constraint markets_exchange_id_fkey on table markets
DROP TABLE
level4=# drop table symbols cascade ;
drop table markets cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table symbols cascade ;
DROP TABLE
level4=# drop table schema_migrations cascade ;
drop table schema_migrations cascade ;
DROP TABLE
level4=# \dt
\dt
Did not find any relations.
level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# SELECT create_hypertable('best_bid_prices', 'timestamp');
SELECT create_hypertable('best_bid_prices', 'timestamp');
ERROR:  cannot create a unique index without the column "timestamp" (used in partitioning)
level4=# 

level4=# \d+ best_bid_prices
\d+ best_bid_prices
                                                           Table "public.best_bid_prices"
  Column   |            Type             | Collation | Nullable |                   Default                   | Storage | Stats target | Description 
-----------+-----------------------------+-----------+----------+---------------------------------------------+---------+--------------+-------------
 id        | bigint                      |           | not null | nextval('best_bid_prices_id_seq'::regclass) | plain   |              | 
 market_id | bigint                      |           | not null |                                             | plain   |              | 
 price     | double precision            |           | not null |                                             | plain   |              | 
 size      | double precision            |           | not null |                                             | plain   |              | 
 timestamp | timestamp without time zone |           | not null |                                             | plain   |              | 
Indexes:
    "best_bid_prices_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "best_bid_prices_market_id_fkey" FOREIGN KEY (market_id) REFERENCES markets(id)
Access method: heap

level4=# 

level4=# 

level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | best_ask_prices   | table | level4
 public | best_bid_prices   | table | level4
 public | exchanges         | table | level4
 public | markets           | table | level4
 public | schema_migrations | table | level4
 public | symbols           | table | level4
(6 rows)

level4=# 

level4=# drop table best_ask_prices
drop table best_ask_prices
level4-# ;
;
DROP TABLE
level4=# drop table best_bid_prices;
drop table best_bid_prices;
DROP TABLE
level4=# drop table exchanges exchanges;
drop table exchanges exchanges;
ERROR:  syntax error at or near "exchanges"
LINE 1: drop table exchanges cascade ;
                             ^
level4=# LINE 1: drop table exchanges cascade ;
LINE 1: drop table exchanges
ERROR:  syntax error at or near "LINE"
LINE 1: LINE 1: drop table exchanges cascade ;
        ^
level4=# LINE 1: drop table exchanges
LINE 1: drop table exchanges
level4-# 

level4-# 

level4-# drop table exchanges cascade ;
drop table exchanges cascade ;
ERROR:  syntax error at or near "LINE"
LINE 1: LINE 1: drop table exchanges
        ^
level4=# 

level4=# 

level4=# drop table markets cascade ;
drop table exchanges cascade ;
NOTICE:  drop cascades to constraint markets_exchange_id_fkey on table markets
DROP TABLE
level4=# drop table symbols cascade ;
drop table markets cascade ;
DROP TABLE
level4=# drop table symbols cascade ;
drop table symbols cascade ;
DROP TABLE
level4=# \dt
\dt
              List of relations
 Schema |       Name        | Type  | Owner  
--------+-------------------+-------+--------
 public | schema_migrations | table | level4
(1 row)

level4=# drop table schema_migrations ;
drop table schema_migrations ;
DROP TABLE
level4=# 

level4=# 

level4=# 

level4=# \dt
\dt
Did not find any relations.
level4=# \d+ best_bid_prices
\d+ best_bid_prices
                                         Table "public.best_bid_prices"
  Column   |            Type             | Collation | Nullable | Default | Storage | Stats target | Description 
-----------+-----------------------------+-----------+----------+---------+---------+--------------+-------------
 market_id | bigint                      |           | not null |         | plain   |              | 
 price     | double precision            |           | not null |         | plain   |              | 
 size      | double precision            |           | not null |         | plain   |              | 
 timestamp | timestamp without time zone |           | not null |         | plain   |              | 
Foreign-key constraints:
    "best_bid_prices_market_id_fkey" FOREIGN KEY (market_id) REFERENCES markets(id)
Access method: heap

level4=# 

level4=# 

level4=# SELECT create_hypertable('best_bid_prices', 'timestamp');
SELECT create_hypertable('best_bid_prices', 'timestamp');
      create_hypertable       
------------------------------
 (4,public,best_bid_prices,t)
(1 row)

level4=# SELECT create_hypertable('best_ask_prices', 'timestamp');
SELECT create_hypertable('best_ask_prices', 'timestamp');
      create_hypertable       
------------------------------
 (5,public,best_ask_prices,t)
(1 row)

level4=# 

level4=# 

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count 
-------
   147
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count 
-------
   375
(1 row)

level4=# select * from markets ;
select * from symbols ;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
(4 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
(3 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               1 |               4 |           1 | SPOT
(4 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               1 |               4 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               5 |               2 |           1 | SPOT
(6 rows)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count 
-------
 28856
(1 row)

level4=# select * from exchanges ;
select * from exchanges ;
 id |     name     
----+--------------
  1 | COINBASE-PRO
(1 row)

level4=# select * from exchanges ;
select * from exchanges ;
 id |     name     
----+--------------
  1 | COINBASE-PRO
  2 | POLONIEX
(2 rows)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count 
-------
 77755
(1 row)

level4=# select * from best_bid_prices limit 25 ;
select * from best_bid_prices limit 10 ;
 market_id | price  |    size     |         timestamp          
-----------+--------+-------------+----------------------------
         1 | 121.96 |         3.5 | 2021-12-08 00:31:39.913589
         1 | 121.97 |      0.9955 | 2021-12-08 00:31:40.82103
         1 | 121.98 |         3.5 | 2021-12-08 00:31:40.853845
         1 | 121.99 |      0.9955 | 2021-12-08 00:31:40.909144
         1 |    122 |         3.5 | 2021-12-08 00:31:40.963028
         1 | 121.98 |         3.5 | 2021-12-08 00:31:48.728648
         1 | 121.95 | 52.47925118 | 2021-12-08 00:31:49.43994
         1 | 121.96 |         3.5 | 2021-12-08 00:31:49.551163
         1 | 121.92 | 18.55398159 | 2021-12-08 00:31:54.324723
         1 | 121.95 |  9.27767555 | 2021-12-08 00:31:54.338896
(10 rows)

level4=# select * from best_bid_prices limit 25 ;
select * from best_bid_prices limit 100 ;
 market_id | price  |    size     |         timestamp          
-----------+--------+-------------+----------------------------
         1 | 121.96 |         3.5 | 2021-12-08 00:31:39.913589
         1 | 121.97 |      0.9955 | 2021-12-08 00:31:40.82103
         1 | 121.98 |         3.5 | 2021-12-08 00:31:40.853845
         1 | 121.99 |      0.9955 | 2021-12-08 00:31:40.909144
         1 |    122 |         3.5 | 2021-12-08 00:31:40.963028
         1 | 121.98 |         3.5 | 2021-12-08 00:31:48.728648
         1 | 121.95 | 52.47925118 | 2021-12-08 00:31:49.43994
         1 | 121.96 |         3.5 | 2021-12-08 00:31:49.551163
         1 | 121.92 | 18.55398159 | 2021-12-08 00:31:54.324723
         1 | 121.95 |  9.27767555 | 2021-12-08 00:31:54.338896
         1 | 121.92 | 18.55398159 | 2021-12-08 00:31:54.415614
         1 | 121.91 | 13.11019084 | 2021-12-08 00:31:54.489903
         1 | 121.92 |         3.5 | 2021-12-08 00:31:54.51547
         1 | 121.91 | 13.11019084 | 2021-12-08 00:31:55.322891
         1 | 121.92 |      0.9955 | 2021-12-08 00:32:01.875342
         1 | 121.95 |  2.53252478 | 2021-12-08 00:32:01.922249
         1 | 121.96 |         3.5 | 2021-12-08 00:32:01.99249
         1 | 121.99 |  9.27562065 | 2021-12-08 00:32:02.010076
         1 |    122 |         3.5 | 2021-12-08 00:32:02.063832
         1 | 122.03 |  2.17827867 | 2021-12-08 00:32:02.183087
         1 |    122 |         3.5 | 2021-12-08 00:32:02.366137
         1 | 122.02 |   9.2734012 | 2021-12-08 00:32:02.951335
         1 | 121.99 | 18.54674362 | 2021-12-08 00:32:03.621967
         1 | 121.98 |  2.17945751 | 2021-12-08 00:32:04.292851
         1 | 121.95 |  2.53252478 | 2021-12-08 00:32:04.305219
(25 rows)

level4=# select * from best_bid_prices limit 100 ;
select * from best_bid_prices limit 100 ;
 market_id | price  |    size     |         timestamp          
-----------+--------+-------------+----------------------------
         1 | 121.96 |         3.5 | 2021-12-08 00:31:39.913589
         1 | 121.97 |      0.9955 | 2021-12-08 00:31:40.82103
         1 | 121.98 |         3.5 | 2021-12-08 00:31:40.853845
         1 | 121.99 |      0.9955 | 2021-12-08 00:31:40.909144
         1 |    122 |         3.5 | 2021-12-08 00:31:40.963028
         1 | 121.98 |         3.5 | 2021-12-08 00:31:48.728648
         1 | 121.95 | 52.47925118 | 2021-12-08 00:31:49.43994
         1 | 121.96 |         3.5 | 2021-12-08 00:31:49.551163
         1 | 121.92 | 18.55398159 | 2021-12-08 00:31:54.324723
         1 | 121.95 |  9.27767555 | 2021-12-08 00:31:54.338896
         1 | 121.92 | 18.55398159 | 2021-12-08 00:31:54.415614
         1 | 121.91 | 13.11019084 | 2021-12-08 00:31:54.489903
         1 | 121.92 |         3.5 | 2021-12-08 00:31:54.51547
         1 | 121.91 | 13.11019084 | 2021-12-08 00:31:55.322891
         1 | 121.92 |      0.9955 | 2021-12-08 00:32:01.875342
         1 | 121.95 |  2.53252478 | 2021-12-08 00:32:01.922249
         1 | 121.96 |         3.5 | 2021-12-08 00:32:01.99249
         1 | 121.99 |  9.27562065 | 2021-12-08 00:32:02.010076
         1 |    122 |         3.5 | 2021-12-08 00:32:02.063832
         1 | 122.03 |  2.17827867 | 2021-12-08 00:32:02.183087
         1 |    122 |         3.5 | 2021-12-08 00:32:02.366137
         1 | 122.02 |   9.2734012 | 2021-12-08 00:32:02.951335
         1 | 121.99 | 18.54674362 | 2021-12-08 00:32:03.621967
         1 | 121.98 |  2.17945751 | 2021-12-08 00:32:04.292851
         1 | 121.95 |  2.53252478 | 2021-12-08 00:32:04.305219
         1 | 121.92 |      0.9955 | 2021-12-08 00:32:04.306117
         1 | 122.01 |  9.27479154 | 2021-12-08 00:32:04.310481
         1 | 121.97 |  18.5506797 | 2021-12-08 00:32:04.519634
         1 | 121.98 |         3.5 | 2021-12-08 00:32:05.007274
         1 |    122 |  9.27583338 | 2021-12-08 00:32:05.260597
         1 | 121.97 |  18.5506797 | 2021-12-08 00:32:06.13599
         1 | 121.99 |  9.27643357 | 2021-12-08 00:32:06.171101
--More-- 
         1 | 121.95 | 21.11341502 | 2021-12-08 00:32:06.269793
--More-- 
         1 | 121.92 | 13.11019084 | 2021-12-08 00:32:06.375372
--More-- 
         1 | 121.91 |  2.61637883 | 2021-12-08 00:32:06.375455
--More-- 
         1 | 121.89 |      0.9955 | 2021-12-08 00:32:06.401381
--More-- 
         1 |  121.9 |  8.21221165 | 2021-12-08 00:32:06.42877
--More-- 
         1 | 121.91 |         3.5 | 2021-12-08 00:32:06.507573
--More-- 
         1 |  121.9 |  8.21221165 | 2021-12-08 00:32:08.973367
--More-- 
         1 | 121.85 |  2.28577843 | 2021-12-08 00:32:10.488178
--More-- 
         1 | 121.79 | 38.24154134 | 2021-12-08 00:32:10.504964
--More-- 
         1 |  121.8 |      0.9955 | 2021-12-08 00:32:10.513707
--More-- 
         1 | 121.85 |  8.21558146 | 2021-12-08 00:32:10.515837
--More-- 
         1 | 121.81 |  9.28864195 | 2021-12-08 00:32:14.825165
--More-- 
         1 |  121.8 |         3.5 | 2021-12-08 00:32:15.570329
--More-- 
         1 | 121.79 | 47.53101379 | 2021-12-08 00:32:15.677456
--More-- 
         1 |  121.8 |         3.5 | 2021-12-08 00:32:15.885807
--More-- 
         1 | 121.81 |  0.00466696 | 2021-12-08 00:32:16.694124
--More-- 


         1 | 121.75 | 20.96662888 | 2021-12-08 00:32:17.635597
         1 | 121.76 |  0.00466696 | 2021-12-08 00:32:17.648441
         1 |  121.7 |      0.9955 | 2021-12-08 00:32:17.656353
--More-- 
         1 | 121.74 | 11.31185905 | 2021-12-08 00:32:17.660459
--More-- 
         1 | 121.76 |  9.29133053 | 2021-12-08 00:32:17.670752
--More-- 
         1 | 121.77 |  0.00466696 | 2021-12-08 00:32:17.674193
--More-- 
         1 | 121.78 |  0.00466696 | 2021-12-08 00:32:17.710448
--More-- 
         1 | 121.73 | 18.58266105 | 2021-12-08 00:32:18.133294
--More-- 
         1 | 121.71 |  2.24959344 | 2021-12-08 00:32:18.133452
--More-- 
         1 | 121.74 |  0.00466696 | 2021-12-08 00:32:18.149226
--More-- 
         1 |  121.7 | 20.43551293 | 2021-12-08 00:32:18.187846
--More-- 
         1 | 121.71 |  0.00466696 | 2021-12-08 00:32:18.196194
--More-- 
         1 | 121.72 |  0.00466696 | 2021-12-08 00:32:18.242486
--More-- 
         1 | 121.68 | 41.05221241 | 2021-12-08 00:32:18.55077
--More-- 
         1 | 121.69 |  0.00466696 | 2021-12-08 00:32:18.566287
--More-- 
         1 |  121.7 |  9.29558394 | 2021-12-08 00:32:18.696238
--More-- 
         1 | 121.71 |  0.00466696 | 2021-12-08 00:32:18.714985
--More-- 
         1 | 121.72 |  0.00466696 | 2021-12-08 00:32:19.616971
--More-- 
         1 | 121.73 |      0.9955 | 2021-12-08 00:32:19.87388
--More-- 
         1 | 121.75 |   9.2918967 | 2021-12-08 00:32:21.191299
--More-- 
         1 | 121.76 |  0.00677138 | 2021-12-08 00:32:21.212099
--More-- 
         1 | 121.72 |  2.38413272 | 2021-12-08 00:32:21.232558
--More-- 
         1 | 121.73 |  0.00677138 | 2021-12-08 00:32:21.236788
--More-- 
         1 | 121.74 |  0.00677138 | 2021-12-08 00:32:22.780784
--More-- 
         1 | 121.75 |         3.5 | 2021-12-08 00:32:23.984296
--More-- 
         1 | 121.76 |  0.00561798 | 2021-12-08 00:32:24.001335
--More-- 
         1 | 121.77 |  0.00535857 | 2021-12-08 00:32:26.383089
--More-- 


         1 | 121.78 |  0.00535857 | 2021-12-08 00:32:26.438128
         1 | 121.75 |  9.29232403 | 2021-12-08 00:32:33.84764
         1 | 121.72 |  2.38413272 | 2021-12-08 00:32:33.896222
--More-- 
         1 | 121.69 |  2.28984354 | 2021-12-08 00:32:33.943513
--More-- 
         1 |  121.7 |         3.5 | 2021-12-08 00:32:33.988124
--More-- 
         1 | 121.72 |  2.42818023 | 2021-12-08 00:32:42.555234
--More-- 
         1 | 121.73 |         3.5 | 2021-12-08 00:32:42.576867
--More-- 
         1 | 121.74 |  9.29314136 | 2021-12-08 00:32:42.622764
--More-- 
         1 | 121.75 |         3.5 | 2021-12-08 00:32:42.645
--More-- 
         1 | 121.74 |  9.29391782 | 2021-12-08 00:32:47.081375
--More-- 
         1 | 121.72 |  2.42818023 | 2021-12-08 00:32:47.522925
--More-- 
         1 |  121.7 | 18.58873148 | 2021-12-08 00:32:47.52337
--More-- 
         1 | 121.71 |         3.5 | 2021-12-08 00:32:47.566345
--More-- 
         1 | 121.72 |  9.29553126 | 2021-12-08 00:32:48.12589
--More-- 
         1 | 121.73 |         3.5 | 2021-12-08 00:32:50.290955
--More-- 
         1 | 121.76 |  2.26039446 | 2021-12-08 00:32:51.223759
--More-- 
         1 | 121.77 |         3.5 | 2021-12-08 00:32:51.258466
--More-- 
         1 | 121.79 |  2.63181284 | 2021-12-08 00:33:05.928467
--More-- 
         1 |  121.8 |      0.9955 | 2021-12-08 00:33:06.005251
--More-- 
         1 | 121.82 |  2.57674751 | 2021-12-08 00:33:06.134879
--More-- 
         1 | 121.83 |         3.5 | 2021-12-08 00:33:06.168493
--More-- 
         1 | 121.85 |  2.45424963 | 2021-12-08 00:33:06.3004
--More-- 
         1 | 121.86 |         3.5 | 2021-12-08 00:33:06.31749
--More-- 
         1 | 121.83 |         3.5 | 2021-12-08 00:33:10.019178
--More-- 
         1 | 121.82 | 21.15151349 | 2021-12-08 00:33:10.049822
--More-- 
(100 rows)
--More-- 
         
level4=# 



level4=# 
level4=# 
level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# 

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               1 |               4 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               5 |               2 |           1 | SPOT
  7 |               3 |               6 |           2 | SPOT
  8 |               5 |               6 |           2 | SPOT
  9 |               1 |               6 |           2 | SPOT
(9 rows)

level4=# select count(*) from best_bid_prices where market_id = 8;
select count(*) from best_bid_prices where market_id = 5;
 count 
-------
 32556
(1 row)

level4=# select count(*) from best_bid_prices where market_id = 1;
select count(*) from best_bid_prices where market_id = 8;
 count 
-------
  2187
(1 row)

level4=# select * from symbols ;
select * from symbols ;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | USDT
(6 rows)

level4=# 

level4=# select count(*) from best_bid_prices where market_id = 2;
select count(*) from best_bid_prices where market_id = 1;
 count 
-------
  4006
(1 row)

level4=# select count(*) from best_bid_prices where market_id = 4;
select count(*) from best_bid_prices where market_id = 2;
 count 
-------
  9579
(1 row)

level4=# select count(*) from best_bid_prices where market_id = 6;
select count(*) from best_bid_prices where market_id = 4;
 count 
-------
  7295
(1 row)

level4=# select count(*) from best_bid_prices where market_id = 6;
select count(*) from best_bid_prices where market_id = 6;
 count 
-------
  8572
(1 row)

level4=# \l+
\l+
                                                                List of databases
   Name    | Owner  | Encoding |  Collate   |   Ctype    | Access privileges |  Size   | Tablespace |                Description                 
-----------+--------+----------+------------+------------+-------------------+---------+------------+--------------------------------------------
 level4    | level4 | UTF8     | en_US.utf8 | en_US.utf8 |                   | 35 MB   | pg_default | 
 postgres  | level4 | UTF8     | en_US.utf8 | en_US.utf8 |                   | 9233 kB | pg_default | default administrative connection database
 template0 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +| 7825 kB | pg_default | unmodifiable empty database
           |        |          |            |            | level4=CTc/level4 |         |            | 
 template1 | level4 | UTF8     | en_US.utf8 | en_US.utf8 | =c/level4        +| 9241 kB | pg_default | default template for new databases
           |        |          |            |            | level4=CTc/level4 |         |            | 
(4 rows)

level4=# 

level4=# select count(*) from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               1 |               4 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               5 |               2 |           1 | SPOT
  7 |               3 |               6 |           2 | SPOT
  8 |               5 |               6 |           2 | SPOT
  9 |               1 |               6 |           2 | SPOT
(9 rows)

level4=# select count(*) from markets ;
select count(*) from markets ;
 count 
-------
     9
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
 count  
--------
 110863
(1 row)

level4=# select count(*) from best_ask_prices ;
select count(*) from best_ask_prices ;
 count  
--------
 102552
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
 count  
--------
 130730
(1 row)

level4=# select count(*) from best_bid_prices ;
select count(*) from best_bid_prices ;
 count  
--------
 150594
(1 row)

level4=# select time_bucket('1 minute', timestamp) as minute from best_bid_prices where market_id = 3 and timestamp > now() - interval '30m' group by minute order by minute asc ;
select time_bucket('1 minute', timestamp) as minute from best_bid_prices where market_id = 2 and timestamp > now() - interval '30m' group by minute order by minute asc ;
       minute        
---------------------
 2021-12-08 01:37:00
 2021-12-08 01:38:00
 2021-12-08 01:39:00
 2021-12-08 01:40:00
 2021-12-08 01:41:00
 2021-12-08 01:42:00
 2021-12-08 01:43:00
 2021-12-08 01:44:00
 2021-12-08 01:45:00
 2021-12-08 01:46:00
 2021-12-08 01:47:00
 2021-12-08 01:48:00
 2021-12-08 01:49:00
 2021-12-08 01:50:00
 2021-12-08 01:51:00
 2021-12-08 01:52:00
 2021-12-08 01:53:00
 2021-12-08 01:54:00
 2021-12-08 01:55:00
 2021-12-08 01:56:00
 2021-12-08 01:57:00
 2021-12-08 01:58:00
 2021-12-08 01:59:00
 2021-12-08 02:00:00
 2021-12-08 02:01:00
 2021-12-08 02:02:00
 2021-12-08 02:03:00
 2021-12-08 02:04:00
 2021-12-08 02:05:00
 2021-12-08 02:06:00
 2021-12-08 02:07:00
(31 rows)

level4=# 

level4=# 

level4=# select * from symbols ;
select * from symbols ;
 id | symbol 
----+--------
  1 | LTC
  2 | GBP
  3 | BTC
  4 | USD
  5 | ETH
  6 | USDT
(6 rows)

level4=# select * from markets ;
select * from markets ;
 id | major_symbol_id | quote_symbol_id | exchange_id | market_type 
----+-----------------+-----------------+-------------+-------------
  1 |               1 |               2 |           1 | SPOT
  2 |               3 |               2 |           1 | SPOT
  3 |               3 |               4 |           1 | SPOT
  4 |               1 |               4 |           1 | SPOT
  5 |               5 |               4 |           1 | SPOT
  6 |               5 |               2 |           1 | SPOT
  7 |               3 |               6 |           2 | SPOT
  8 |               5 |               6 |           2 | SPOT
  9 |               1 |               6 |           2 | SPOT
(9 rows)

level4=# select time_bucket('1 minute', timestamp) as minute, first(price, timestamp) as open, last(price, timestamp) as close, max(price, timestamp) as high, min(price, timestamp) as low, avg(price, timestamp) as avg,  from best_bid_prices where market_id = 3 and timestamp > now() - interval '30m' group by minute order by minute asc ;
select time_bucket('1 minute', timestamp) as minute from best_bid_prices where market_id = 3 and timestamp > now() - interval '30m' group by minute order by minute asc ;
       minute        
---------------------
 2021-12-08 01:38:00
 2021-12-08 01:39:00
 2021-12-08 01:40:00
 2021-12-08 01:41:00
 2021-12-08 01:42:00
 2021-12-08 01:43:00
 2021-12-08 01:44:00
 2021-12-08 01:45:00
 2021-12-08 01:46:00
 2021-12-08 01:47:00
 2021-12-08 01:48:00
 2021-12-08 01:49:00
 2021-12-08 01:50:00
 2021-12-08 01:51:00
 2021-12-08 01:52:00
 2021-12-08 01:53:00
 2021-12-08 01:54:00
 2021-12-08 01:55:00
 2021-12-08 01:56:00
 2021-12-08 01:57:00
 2021-12-08 01:58:00
 2021-12-08 01:59:00
 2021-12-08 02:00:00
 2021-12-08 02:01:00
 2021-12-08 02:02:00
 2021-12-08 02:03:00
 2021-12-08 02:04:00
 2021-12-08 02:05:00
 2021-12-08 02:06:00
 2021-12-08 02:07:00
 2021-12-08 02:08:00
(31 rows)

level4=# 

level4=# 

level4=# select time_bucket('1 minute', timestamp) as minute, first(price, timestamp) as open, last(price, timestamp) as close, max(price, timestamp) as high, min(price, timestamp) as low, avg(price, timestamp) as avg from best_bid_prices where market_id = 3 and timestamp > now() - interval '30m' group by minute order by minute asc ;
select time_bucket('1 minute', timestamp) as minute, first(price, timestamp) as open, last(price, timestamp) as close, max(price, timestamp) as high, min(price, timestamp) as low, avg(price, timestamp) as avg,  from best_bid_prices where market_id = 3 and timestamp > now() - interval '30m' group by minute order by minute asc ;
ERROR:  syntax error at or near "from"
LINE 1: ...timestamp) as low, avg(price, timestamp) as avg,  from best_...
                                                             ^
level4=# 